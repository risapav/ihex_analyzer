/*
 * This file is part of the Bus Pirate project (http://code.google.com/p/the-bus-pirate/).
 *
 * Written and maintained by the Bus Pirate project.
 *
 * To the extent possible under law, the project has
 * waived all copyright and related or neighboring rights to Bus Pirate. 
 *
 * For details see: http://creativecommons.org/publicdomain/zero/1.0/.
 *
 *    This program is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 */

//set the location where the new bootloader should be written
//is used for the write location, and to write the jump instruction at location 0x0000
#ifndef __DEBUG
	#define FWLOCATION	0xA800 //actual last page
#else // use a safe location for now :D since i don't have a proper programmer (someone wants to send me one?? :P)
	#define FWLOCATION	0x9000 
#endif

//this is the jump to bootloader address. 
//at end of upgrade the program will jump straight to the new bootloader
//this must be defined in asm
asm (".equ BLJUMPADDRESS, 0xABF8");

//define the location in the firmware array where the version is stored
//used to tell the user what version they're upgrading to
#define FWBLVERLOC_MAJ		1529		// location where version number (major) is stored
#define FWBLVERLOC_MIN		1528		// location where version number (minor) is stored


// test firmware (size should be exactly 1 page!)
// replace with the right bootloader
//export the page containing the firmware from MPLAB as a HEX
// convert the HEX to a byte array with the .html javascript converter
//if the bootloader is in the last page (Bus Pirate) don;t forget the config words
const unsigned char firmware [512*3] = {
0x20, 0x2f, 0x8c, 0xa9, 0x42, 0x27, 0xa9, 0x45, 0x07, 0xae, 0x42, 0xa7,   // 0
0x37, 0xfe, 0xff, 0x2f, 0xf0, 0xff, 0x88, 0x60, 0x19, 0x22, 0xc0, 0x7f,   // 1
0x78, 0xb0, 0x00, 0x25, 0x62, 0x92, 0xe1, 0x02, 0x08, 0x3a, 0x08, 0x00,   // 2
0x78, 0x90, 0x00, 0x23, 0x12, 0x14, 0xe1, 0x02, 0x08, 0x3a, 0x04, 0x00,   // 3
0x22, 0xa0, 0x7f, 0xe0, 0x10, 0x04, 0xeb, 0x00, 0x48, 0x3a, 0x0c, 0x00,   // 4
0x22, 0xa0, 0x7f, 0xeb, 0x00, 0x48, 0xa9, 0xcc, 0x22, 0xa8, 0xc8, 0x22,   // 5
0xa8, 0x68, 0xa0, 0xa9, 0xcc, 0x02, 0xa9, 0xc8, 0x02, 0x00, 0x00, 0x00,   // 6
0x00, 0x00, 0x00, 0xaf, 0xca, 0x22, 0x37, 0xa2, 0x00, 0xeb, 0x00, 0x04,   // 7
0x80, 0x26, 0x35, 0x80, 0x27, 0x36, 0xa8, 0xa4, 0x06, 0xa9, 0xa4, 0x26,   // 8
0xa8, 0xa4, 0x46, 0xa9, 0xa4, 0x66, 0xa9, 0xa4, 0x86, 0xa8, 0xc4, 0x06,   // 9
0xa8, 0xc4, 0x26, 0xa9, 0xc4, 0x46, 0xa9, 0xc4, 0x66, 0xa9, 0xc4, 0x86,   // 10
0xa8, 0xc4, 0x22, 0xa9, 0xc0, 0x22, 0xeb, 0x80, 0x00, 0x20, 0x20, 0x02,   // 11
0x88, 0x40, 0x11, 0xa8, 0x20, 0x62, 0xa8, 0x21, 0xe2, 0xa8, 0x23, 0x42,   // 12
0x07, 0x73, 0x00, 0xb1, 0x10, 0x0c, 0x32, 0x0b, 0x00, 0xb1, 0x30, 0x02,   // 13
0x32, 0x7f, 0x00, 0x20, 0x20, 0x04, 0x88, 0x20, 0x11, 0x20, 0xc0, 0x04,   // 14
0x88, 0x20, 0x11, 0x20, 0x40, 0x03, 0x88, 0x20, 0x11, 0x20, 0xb0, 0x02,   // 15
0x88, 0x20, 0x11, 0x37, 0x73, 0x00, 0x20, 0x40, 0x0d, 0x88, 0x20, 0x11,   // 16
0x20, 0x10, 0x00, 0x88, 0x20, 0x11, 0x20, 0x20, 0x00, 0x88, 0x20, 0x11,   // 17
0x20, 0xb0, 0x04, 0x88, 0x20, 0x11, 0xeb, 0x00, 0x07, 0x07, 0x5c, 0x00,   // 18
0x88, 0x90, 0x01, 0x07, 0x5a, 0x00, 0xb7, 0x03, 0xe1, 0x07, 0x58, 0x00,   // 19
0xb7, 0x02, 0xe1, 0xbf, 0x02, 0x81, 0x78, 0x80, 0x02, 0x78, 0x00, 0x02,   // 20
0x07, 0x53, 0x00, 0x78, 0x80, 0x06, 0x07, 0x51, 0x00, 0x78, 0x80, 0x01,   // 21
0x20, 0x02, 0x80, 0x07, 0x4e, 0x00, 0x78, 0x00, 0x59, 0xe9, 0x83, 0x01,   // 22
0x3a, 0xfc, 0xff, 0xe0, 0x0e, 0x04, 0x32, 0x03, 0x00, 0x20, 0xe0, 0x04,   // 23
0x88, 0x20, 0x11, 0x37, 0xe8, 0xff, 0x2a, 0x03, 0x7c, 0xe1, 0x03, 0x28,   // 24
0x3e, 0x10, 0x00, 0xe0, 0x05, 0x00, 0x3a, 0x12, 0x00, 0x20, 0x02, 0x80,   // 25
0xb3, 0x40, 0xc0, 0x78, 0x00, 0x59, 0xb3, 0x00, 0xc0, 0x78, 0x00, 0x59,   // 26
0xb3, 0x80, 0xca, 0x78, 0x00, 0x59, 0xb3, 0x00, 0xc0, 0x78, 0x00, 0x59,   // 27
0xb3, 0x00, 0xc0, 0x78, 0x00, 0x59, 0xb3, 0x00, 0xc0, 0x78, 0x00, 0x59,   // 28
0x37, 0x04, 0x00, 0xeb, 0x80, 0x00, 0x20, 0x00, 0x05, 0x88, 0x20, 0x11,   // 29
0x37, 0xd1, 0xff, 0x20, 0x02, 0x80, 0xa7, 0x0d, 0x10, 0x37, 0x02, 0x00,   // 30
0x2f, 0xf1, 0xff, 0x37, 0xca, 0xff, 0xa6, 0x01, 0x00, 0x37, 0x04, 0x00,   // 31
0xbb, 0x85, 0x0a, 0x24, 0x20, 0x04, 0x07, 0x1a, 0x00, 0xeb, 0x80, 0x00,   // 32
0x20, 0x03, 0x04, 0xbb, 0xb2, 0xca, 0xbb, 0xb2, 0x5a, 0xbb, 0xb2, 0x5a,   // 33
0xe9, 0x83, 0x01, 0x3a, 0xfb, 0xff, 0x24, 0x10, 0x00, 0x07, 0x11, 0x00,   // 34
0x20, 0x03, 0x04, 0x20, 0x02, 0x80, 0xba, 0x14, 0xc0, 0xe1, 0x32, 0x04,   // 35
0x3a, 0x09, 0x00, 0xba, 0x34, 0x40, 0xe1, 0x32, 0x04, 0x3a, 0x06, 0x00,   // 36
0xba, 0x34, 0x40, 0xe1, 0x32, 0x04, 0x3a, 0x03, 0x00, 0xe9, 0x83, 0x01,   // 37
0x3a, 0xf5, 0xff, 0x37, 0xae, 0xff, 0x20, 0x60, 0x05, 0x88, 0x20, 0x11,   // 38
0x37, 0xad, 0xff, 0x88, 0x00, 0x3b, 0x20, 0x50, 0x05, 0x88, 0x30, 0x3b,   // 39
0x20, 0xa0, 0x0a, 0x88, 0x30, 0x3b, 0xa8, 0x61, 0xe7, 0x00, 0x00, 0x00,   // 40
0x00, 0x00, 0x00, 0xaf, 0x61, 0xe7, 0x37, 0xfe, 0xff, 0x06, 0x00, 0x00,   // 41
0x20, 0x1a, 0x01, 0xeb, 0x80, 0x05, 0xfe, 0x00, 0x60, 0xae, 0x22, 0x02,   // 42
0x37, 0x03, 0x00, 0x80, 0x30, 0x11, 0x47, 0x00, 0x07, 0x06, 0x00, 0x00,   // 43
0xe9, 0x8b, 0x05, 0x3a, 0xf8, 0xff, 0xe9, 0x0a, 0x05, 0x3a, 0xf5, 0xff,   // 44
0x20, 0x2f, 0x8c, 0xa6, 0x08, 0x00, 0xae, 0xca, 0x22, 0x37, 0x68, 0xff,   // 45
0xa9, 0x85, 0x60, 0xa9, 0x85, 0x80, 0xa9, 0x23, 0x42, 0xa9, 0x21, 0xe2,   // 46
0xef, 0x02, 0x21, 0xa9, 0xc4, 0x22, 0xa8, 0xc0, 0x22, 0x88, 0x26, 0x35,   // 47
0x88, 0x27, 0x36, 0xa9, 0x68, 0xa0, 0xa8, 0xc8, 0x02, 0x20, 0x00, 0x00,   // 48
0x88, 0x60, 0x19, 0x37, 0x38, 0xff, 0x2f, 0xf8, 0xff, 0x37, 0x58, 0xff,   // 49
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 50
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 51
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 52
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 53
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 54
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 55
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 56
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 57
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 58
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 59
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 60
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 61
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 62
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 63
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 64
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 65
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 66
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 67
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 68
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 69
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 70
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 71
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 72
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 73
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 74
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 75
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 76
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 77
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 78
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 79
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 80
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 81
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 82
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 83
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 84
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 85
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 86
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 87
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 88
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 89
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 90
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 91
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 92
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 93
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 94
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 95
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 96
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 97
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 98
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 99
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 100
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 101
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 102
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 103
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 104
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 105
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 106
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 107
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 108
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 109
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 110
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 111
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 112
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 113
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 114
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 115
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 116
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 117
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 118
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 119
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 120
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 121
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 122
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 123
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 124
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 125
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // 126
0x37, 0xC9, 0xFE, 0x00, 0x05, 0x04,   // 127 c9fe370005040000 0x37, 0xc9, 0xfe, 0x00, 0x05, 0x04,   // 0
0x00, 0xDF, 0xF9, 0x00, 0x7F, 0x3F,   // 128 (config fuses, stay the same)
};
